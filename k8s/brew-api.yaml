apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: brew-api
  name: brew-api
spec:
  replicas: 2
  strategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: brew-api
        tier: backend
    spec:
      containers:
      - env:
        - name: LOG_LEVEL
          value: info
        - name: NODE_ENV
          value: production
        - name: PROD_DB_USERNAME
          valueFrom:
            secretKeyRef:
              name: brew-api-db
              key: username
        - name: PROD_DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: brew-api-db
              key: password
        - name: PROD_DB_NAME
          value: brew_api
        - name: PROD_DB_HOSTNAME
          value: docker.local.geekspace.us
        - name: SCHEMA_LOCATION
          value: './schema'
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: brew-app-jwt
              key: secret
        image: dariusbakunas/brew-api:0.0.3
        imagePullPolicy: Always
        name: brew-api
        ports:
        - containerPort: 4000
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health-check
            port: 4000
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /health-check
            port: 4000
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources:
          requests:
            cpu: 100m
            memory: 1024Mi
